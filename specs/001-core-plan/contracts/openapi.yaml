openapi: 3.1.0
info:
  title: SaliteMiret Core Plan API
  version: 1.0.0
  description: >
    Aggregated contract mirroring `docs/spec-kit/04-api-contracts.md`.
servers:
  - url: https://salitemiret.local
tags:
  - name: Members
  - name: Payments
  - name: Sponsorships
  - name: Media
  - name: Schools
  - name: Volunteers
  - name: Councils
  - name: Reports
paths:
  /api/resource/Member:
    get:
      tags: [Members]
      summary: List members
      operationId: listMembers
      parameters:
        - name: status
          in: query
          schema:
            type: string
          description: Filter by latest status.
        - name: search
          in: query
          schema:
            type: string
          description: Fuzzy search across names, phone, email.
      responses:
        '200':
          description: Member list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Member'
                  message:
                    type: string
                    nullable: true
    post:
      tags: [Members]
      summary: Create member
      operationId: createMember
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MemberCreateInput'
      responses:
        '201':
          description: Member created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Member'
  /api/resource/Member/{name}:
    get:
      tags: [Members]
      summary: Retrieve member
      operationId: getMember
      parameters:
        - $ref: '#/components/parameters/DocName'
      responses:
        '200':
          description: Member detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Member'
    put:
      tags: [Members]
      summary: Update member
      operationId: updateMember
      parameters:
        - $ref: '#/components/parameters/DocName'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MemberUpdateInput'
      responses:
        '200':
          description: Member updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Member'
  /api/method/salitemiret.api.members.download_template:
    get:
      tags: [Members]
      summary: Download member import template
      operationId: downloadMemberTemplate
      responses:
        '200':
          description: XLSX template
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary
  /api/method/salitemiret.api.members.preview_import:
    post:
      tags: [Members]
      summary: Preview member import
      operationId: previewMemberImport
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [file_id]
              properties:
                file_id:
                  type: string
      responses:
        '200':
          description: Validation summary
          content:
            application/json:
              schema:
                type: object
                properties:
                  summary:
                    $ref: '#/components/schemas/ImportSummary'
                  trace_id:
                    type: string
  /api/method/salitemiret.api.members.import_members:
    post:
      tags: [Members]
      summary: Queue member import job
      operationId: importMembers
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [file_id, dry_run]
              properties:
                file_id:
                  type: string
                dry_run:
                  type: boolean
      responses:
        '200':
          description: Job queued response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobQueued'
  /api/method/salitemiret.api.members.status_suggestions:
    get:
      tags: [Members]
      summary: Fetch status suggestions
      operationId: listStatusSuggestions
      parameters:
        - name: member_id
          in: query
          schema:
            type: string
          required: false
      responses:
        '200':
          description: Suggestion list
          content:
            application/json:
              schema:
                type: object
                properties:
                  suggestions:
                    type: array
                    items:
                      $ref: '#/components/schemas/StatusSuggestion'
                  trace_id:
                    type: string
  /api/method/salitemiret.api.members.approve_status:
    post:
      tags: [Members]
      summary: Approve status suggestion
      operationId: approveStatus
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [member, proposed_status, suggestion_id]
              properties:
                member:
                  type: string
                proposed_status:
                  type: string
                suggestion_id:
                  type: string
                notes:
                  type: string
      responses:
        '200':
          description: Status approval result
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  trace_id:
                    type: string
  /api/resource/Payment:
    get:
      tags: [Payments]
      summary: List payments
      operationId: listPayments
      parameters:
        - name: member
          in: query
          schema:
            type: string
        - name: payment_date
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Payment list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Payment'
    post:
      tags: [Payments]
      summary: Create payment or correction
      operationId: createPayment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentInput'
      responses:
        '201':
          description: Payment created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Payment'
  /api/resource/Sponsorship:
    get:
      tags: [Sponsorships]
      summary: List sponsorships
      operationId: listSponsorships
      parameters:
        - name: status
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Sponsorship list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Sponsorship'
    post:
      tags: [Sponsorships]
      summary: Create sponsorship
      operationId: createSponsorship
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SponsorshipInput'
      responses:
        '201':
          description: Sponsorship created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Sponsorship'
  /api/resource/Media%20Request:
    get:
      tags: [Media]
      summary: List media requests
      operationId: listMediaRequests
      parameters:
        - name: status
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Media requests
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/MediaRequest'
    post:
      tags: [Media]
      summary: Submit media request
      operationId: createMediaRequest
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MediaRequestInput'
      responses:
        '201':
          description: Media request submitted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MediaRequest'
  /api/resource/Public%20Post:
    get:
      tags: [Media]
      summary: List public posts
      operationId: listPublicPosts
      responses:
        '200':
          description: Public posts
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PublicPost'
  /api/resource/Sunday%20School%20Enrollment:
    get:
      tags: [Schools]
      summary: List Sunday School enrollments
      operationId: listSundaySchoolEnrollments
      parameters:
        - name: class_level
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Enrollment list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/SundaySchoolEnrollment'
    post:
      tags: [Schools]
      summary: Create enrollment
      operationId: createSundaySchoolEnrollment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SundaySchoolEnrollmentInput'
      responses:
        '201':
          description: Enrollment created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SundaySchoolEnrollment'
  /api/resource/Volunteer%20Group:
    get:
      tags: [Volunteers]
      summary: List volunteer groups
      operationId: listVolunteerGroups
      responses:
        '200':
          description: Volunteer groups
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/VolunteerGroup'
    post:
      tags: [Volunteers]
      summary: Create volunteer group
      operationId: createVolunteerGroup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VolunteerGroupInput'
      responses:
        '201':
          description: Volunteer group created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VolunteerGroup'
  /api/resource/Volunteer:
    get:
      tags: [Volunteers]
      summary: List volunteers
      operationId: listVolunteers
      parameters:
        - name: group
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Volunteer list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Volunteer'
    post:
      tags: [Volunteers]
      summary: Register volunteer
      operationId: createVolunteer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VolunteerInput'
      responses:
        '201':
          description: Volunteer created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Volunteer'
  /api/resource/Service%20Log:
    get:
      tags: [Volunteers]
      summary: List service logs
      operationId: listServiceLogs
      parameters:
        - name: volunteer
          in: query
          schema:
            type: string
        - name: service_date
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Service log list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ServiceLog'
    post:
      tags: [Volunteers]
      summary: Record service log
      operationId: createServiceLog
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ServiceLogInput'
      responses:
        '201':
          description: Service log recorded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceLog'
  /api/resource/Council%20Department:
    get:
      tags: [Councils]
      summary: List council departments
      operationId: listCouncilDepartments
      responses:
        '200':
          description: Council departments
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/CouncilDepartment'
    post:
      tags: [Councils]
      summary: Create council department
      operationId: createCouncilDepartment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CouncilDepartmentInput'
      responses:
        '201':
          description: Council department created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CouncilDepartment'
  /api/resource/Council%20Trainee:
    get:
      tags: [Councils]
      summary: List council trainees
      operationId: listCouncilTrainees
      parameters:
        - name: department
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Council trainee list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/CouncilTrainee'
    post:
      tags: [Councils]
      summary: Create council trainee
      operationId: createCouncilTrainee
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CouncilTraineeInput'
      responses:
        '201':
          description: Council trainee created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CouncilTrainee'
  /api/method/salitemiret.api.reports.run:
    post:
      tags: [Reports]
      summary: Execute report
      operationId: runReport
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [report_id]
              properties:
                report_id:
                  type: string
                filters:
                  type: object
                  additionalProperties: true
      responses:
        '200':
          description: Report results
          content:
            application/json:
              schema:
                type: object
                properties:
                  columns:
                    type: array
                    items:
                      type: string
                  rows:
                    type: array
                    items:
                      type: array
                      items:
                        type: string
                  trace_id:
                    type: string
components:
  parameters:
    DocName:
      name: name
      in: path
      required: true
      schema:
        type: string
  schemas:
    Member:
      type: object
      properties:
        name:
          type: string
        member_id:
          type: string
        first_name:
          type: string
        last_name:
          type: string
        status:
          type: string
        preferred_language:
          type: string
        trace_id:
          type: string
    MemberCreateInput:
      type: object
      required: [member_id, first_name, last_name, preferred_language]
      properties:
        member_id:
          type: string
        first_name:
          type: string
        last_name:
          type: string
        first_name_am:
          type: string
        last_name_am:
          type: string
        preferred_language:
          type: string
        phone:
          type: string
        birth_date:
          type: string
          format: date
    MemberUpdateInput:
      type: object
      additionalProperties: true
    ImportSummary:
      type: object
      properties:
        total_rows:
          type: integer
        valid_rows:
          type: integer
        errors:
          type: array
          items:
            type: object
            properties:
              row:
                type: integer
              column:
                type: string
              message:
                type: string
    JobQueued:
      type: object
      properties:
        job_id:
          type: string
        message:
          type: string
        trace_id:
          type: string
    StatusSuggestion:
      type: object
      properties:
        member:
          type: string
        proposed_status:
          type: string
        reason:
          type: string
        evidence:
          type: object
          additionalProperties: true
    Payment:
      type: object
      properties:
        name:
          type: string
        payment_reference:
          type: string
        member:
          type: string
        payment_date:
          type: string
          format: date
        amount:
          type: number
        method:
          type: string
        allocation:
          type: string
        correction_of:
          type: string
          nullable: true
        trace_id:
          type: string
    PaymentInput:
      type: object
      required: [payment_reference, member, payment_date, amount, method, allocation]
      properties:
        payment_reference:
          type: string
        member:
          type: string
        payment_date:
          type: string
          format: date
        amount:
          type: number
        method:
          type: string
        allocation:
          type: string
        correction_of:
          type: string
          nullable: true
        memo:
          type: string
    Sponsorship:
      type: object
      properties:
        name:
          type: string
        sponsorship_id:
          type: string
        member:
          type: string
        beneficiary_name:
          type: string
        monthly_amount:
          type: number
        status:
          type: string
        program:
          type: string
    SponsorshipInput:
      type: object
      required: [sponsorship_id, member, beneficiary_name, monthly_amount, status, program]
      properties:
        sponsorship_id:
          type: string
        member:
          type: string
        beneficiary_name:
          type: string
        monthly_amount:
          type: number
        status:
          type: string
        program:
          type: string
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
          nullable: true
    MediaRequest:
      type: object
      properties:
        name:
          type: string
        request_id:
          type: string
        title:
          type: string
        status:
          type: string
        submission_date:
          type: string
          format: date
        due_date:
          type: string
          format: date
          nullable: true
        public_post:
          type: string
          nullable: true
    MediaRequestInput:
      type: object
      required: [request_id, title, ministry_area, submission_date]
      properties:
        request_id:
          type: string
        title:
          type: string
        ministry_area:
          type: string
        description:
          type: string
        submission_date:
          type: string
          format: date
        due_date:
          type: string
          format: date
          nullable: true
    PublicPost:
      type: object
      properties:
        name:
          type: string
        slug:
          type: string
        title:
          type: string
        language:
          type: string
        published_on:
          type: string
          format: date
        source_media_request:
          type: string
    SundaySchoolEnrollment:
      type: object
      properties:
        name:
          type: string
        child:
          type: string
        guardian:
          type: string
        class_level:
          type: string
        status:
          type: string
        expected_graduation:
          type: string
          format: date
    SundaySchoolEnrollmentInput:
      type: object
      required: [child, guardian, class_level, enrollment_date, status]
      properties:
        child:
          type: string
        guardian:
          type: string
        class_level:
          type: string
        enrollment_date:
          type: string
          format: date
        expected_graduation:
          type: string
          format: date
          nullable: true
        status:
          type: string
        mezmur_group:
          type: string
          nullable: true
    VolunteerGroup:
      type: object
      properties:
        name:
          type: string
        group_id:
          type: string
        name_readable:
          type: string
        ministry_area:
          type: string
        coordinator:
          type: string
    VolunteerGroupInput:
      type: object
      required: [group_id, name, ministry_area, coordinator]
      properties:
        group_id:
          type: string
        name:
          type: string
        ministry_area:
          type: string
        coordinator:
          type: string
        meeting_schedule:
          type: string
          nullable: true
    Volunteer:
      type: object
      properties:
        name:
          type: string
        member:
          type: string
        group:
          type: string
        role:
          type: string
        status:
          type: string
        joined_on:
          type: string
          format: date
    VolunteerInput:
      type: object
      required: [member, group, role, status]
      properties:
        member:
          type: string
        group:
          type: string
        role:
          type: string
        status:
          type: string
        joined_on:
          type: string
          format: date
    ServiceLog:
      type: object
      properties:
        name:
          type: string
        volunteer:
          type: string
        service_date:
          type: string
          format: date
        hours:
          type: number
        description:
          type: string
        verified_by:
          type: string
    ServiceLogInput:
      type: object
      required: [volunteer, service_date, hours]
      properties:
        volunteer:
          type: string
        service_date:
          type: string
          format: date
        hours:
          type: number
        description:
          type: string
        verified_by:
          type: string
          nullable: true
    CouncilDepartment:
      type: object
      properties:
        name:
          type: string
        department_id:
          type: string
        chair:
          type: string
        charter:
          type: string
        active:
          type: boolean
    CouncilDepartmentInput:
      type: object
      required: [department_id, name, chair]
      properties:
        department_id:
          type: string
        name:
          type: string
        chair:
          type: string
        charter:
          type: string
        active:
          type: boolean
    CouncilTrainee:
      type: object
      properties:
        name:
          type: string
        trainee_id:
          type: string
        member:
          type: string
        department:
          type: string
        status:
          type: string
        mentor:
          type: string
        expected_completion:
          type: string
          format: date
    CouncilTraineeInput:
      type: object
      required: [trainee_id, member, department, status]
      properties:
        trainee_id:
          type: string
        member:
          type: string
        department:
          type: string
        status:
          type: string
        start_date:
          type: string
          format: date
        expected_completion:
          type: string
          format: date
        mentor:
          type: string
